{% extends "server_connections/forms/ConnectionForm.html" %}
{% load connections_extras %}
{% block form_content %}
    <div class="row">
        <p class="col-xs-12">Local certificates</p>
        <div class="col-xs-12">
            <p>Choose the certificate which authenticates the server. Only certificates with private keys are shown.</p>
        </div>
    </div>
    {% include "server_connections/forms/CertificatePicker.html" with certificate=form.certificate identity=form.identity %}

    <hr>

    <div class="row">
        <p class="col-xs-12">Remote certificates</p>
        <div class="col-xs-12">
            <p>Choose a certification authority (CA) certificate or a peer certificate.</p>
        </div>
    </div>
    {% include "server_connections/forms/CaPicker.html" with form=form %}

    <hr>

    <!-- New Section for Encryption Algorithm Options -->
    <div class="row">
        <div class="col-xs-12">
            <p>Encryption Algorithm</p>
            <div class="form-group">
                <label for="encryption_algorithm">Encryption</label>
                <select id="encryption_algorithm" name="encryption_algorithm" class="form-control">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
            <div class="form-group">
                <label for="hash_option">Hash</label>
                <select id="hash_option" name="hash_option" class="form-control">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
            <div class="form-group">
                <label for="dh_group">DH</label>
                <select id="dh_group" name="dh_group" class="form-control">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
        </div>
    </div>

    <hr>
{% endblock form_content %}

<!-- Include Script to Populate Dropdowns Dynamically -->
{% block extrascripts %}
    <script>
        $(document).ready(function () {
            function populateDropdowns() {
                $.ajax({
                    url: "{% url 'get_ipsec_options' %}",
                    method: "GET",
                    success: function (data) {
                        var encryptionAlgorithms = data.encryption_algorithms;
                        var hashOptions = data.hash_options;
                        var dhGroups = data.dh_groups;

                        // Populate Encryption Algorithm Dropdown
                        var encryptionDropdown = $("#encryption_algorithm");
                        encryptionDropdown.empty();
                        $.each(encryptionAlgorithms, function (index, algorithm) {
                            encryptionDropdown.append($('<option></option>').attr('value', algorithm).text(algorithm));
                        });

                        // Populate Hash Option Dropdown
                        var hashDropdown = $("#hash_option");
                        hashDropdown.empty();
                        $.each(hashOptions, function (index, hash) {
                            hashDropdown.append($('<option></option>').attr('value', hash).text(hash));
                        });

                        // Populate DH Group Dropdown
                        var dhDropdown = $("#dh_group");
                        dhDropdown.empty();
                        $.each(dhGroups, function (index, group) {
                            dhDropdown.append($('<option></option>').attr('value', group).text(group));
                        });
                    },
                    error: function (error) {
                        console.error("Error fetching IPsec options:", error);
                    }
                });
            }

            // Call function to populate dropdowns on page load
            populateDropdowns();
        });
    </script>
{% endblock extrascripts %}
